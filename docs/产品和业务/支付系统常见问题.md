# 支付系统常见问题

## 一、重复支付问题

### why
典型的场景：异步回调慢，或未收到异步回调，用户发起二次提交。

### how
#### 1.交互方式的优化
在收银台中选择对应的渠道，并支付验证通过后，会立即跳转到一个新的页面，如果是网页端，原有的界面则会显示一个弹窗，放置用户再次点击，引导用户在新打开的界面中进行支付。如果是原生app可直接在新页面禁止返回上一个页面。

#### 2.收银台服务层防止重复提交
对支付单做幂等处理，支付单号由应用传入。集群部署时可用缓存或分布式锁防止并发支付。

#### 3.主动查询结果
当跳转到新页面等待支付结果返回时，页面可主动发起查询支付结果，查询返回成功后可跳转到成功页面

 

